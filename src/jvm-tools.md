## JVM 工具 ##

给一个系统定位问题的时候，知识、经验是关键基础，数据是依据，工具是运用知识处理数据的手段。这里说的数据包括：运行日志、异常堆栈、GC日志、线程快照（threaddump）、堆转储快照（heapdump）等。

JDK 自带的 JVM 工具有:

* 1，jps（虚拟机进程状况工具）

jps 可以列出正在运行的虚拟机进程，并显示虚拟机执行主类（main 方法所在的类）名称一级这些进程的本地虚拟机唯一 ID（LVMID）。
对于本地虚拟机进程而言，LVMID 和操作系统的进程 ID（PID）是一致的。

命令格式：
    jps [ option ] [ hostid ]

常用 option 如下：

    * -l 输出主类的全名，如果是 jar 包则输出 jar 包路径
    * -m 输出虚拟机进程启动时传递给主类 main 方法的参数
    * -v 输出虚拟机进程启动时 JVM 参数

* 2，jstat（虚拟机统计信息监视工具）

jstat 是用于监视虚拟机各种运行状态信息的命令行工具。它可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾收集、JIT编译等运行数据。
在没有 GUI 图形界面，只提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具。

命令格式：
    jstat [ option vmid [interval[s|ms] [count]] ]

常用 option 如下：

    * -class 监视类装载、卸载数量、总空间以及类装载所耗费的时间
    * -gc 监视 Java 堆状况，包括 Eden 区、两个 Survivor 区、老年代、永久代等的容量、已用空间、GC时间合计等信息
    * -gccapacity 监视内容与 -gc 基本相同，但输出主要关注 Java 堆各个区域使用到的最大、最小空间，单位KB
    * -gcutil 监视内容与 -gc 基本相同，但输出主要关注已使用空间占总空间的百分比
    * -gccause 监视内容与 -gc 基本相同，但额外输出导致上一次 gc 产生的原因
    * -gcnew 监视新生代 GC 状况
    * -gcold 监视老年代 GC 状况
    * -gcmetacapacity 输出永久代使用到的最大、最小空间

* 3，jinfo（Java 配置信息工具）

jinfo 的作用是实时地查看和调整虚拟机各项参数。

命令格式：
    jinfo [ option ] pid

常用 option 如下：

    * -flag 查询或修改指定的虚拟机参数

* 4，jmap（Java 内存映射工具）

jmap 命令用于生成堆转储快照（一般称为 heapdump），另外还可以查询 finalize 执行队列、Java 堆和永久代的详细信息，如空间使用率、当前用的是哪种收集器。

命令格式：
    jmap [ option ] vmid

常用 option 如下：

    * -dump 生成 Java 堆转出快照。格式为： -dump:[live] format=b,file=<filename>，其中 live 子参数说明是否只 dump 出存活的对象
    * -heap 显示 Java 堆详细信息，如使用哪种回收器、参数配置、分代状况等
    * -histo 显示堆中对象统计信息，包括类、实例数量、合计容量

* 5，jhat（虚拟机堆转储快照分析工具）

jhat 命令可与 jmap 命令搭配使用，来分析 jmap 生成的堆转储快照。不过因为有其他可视化的分析工具，一般不会使用此工具。

命令格式：
    jhat <dump>.bin

* 6，jstack（Java 堆栈跟踪工具）

jstack 命令用于生成虚拟机当前时刻的线程快照（一般称为 threaddump）。线程快照就是当前虚拟机内每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程间死锁、死循环、请求外部资源导致的长时间等待等都是导致线程长时间停顿的常见原因。

命令格式：
    jstack [ option ] vmid

常用 option 如下：

    * -F 当正常输出的请求不被响应时，强制输出线程堆栈
    * -l 除堆栈外，显示关于锁的附加信息

















